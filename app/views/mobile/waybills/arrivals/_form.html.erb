<div class="p-4 min-h-full flex flex-col justify-between" data-controller="bridge--scanner" data-bridge-manual="true">
  <div class="space-y-6">
    <div class="bg-white p-4 rounded-lg">
      <%= native_form_with model: waybill, url: mobile_waybill_form_url(waybill), html: { data: { turbo_action: "replace" } } do |form| %>
        <div>
          <%= form.label :new_storage_id, class: "form-label" %>
          <%= form.select :new_storage_id, options_from_collection_for_select(Current.user.storages.acceptable, :id, :name, waybill.new_storage_id), { include_blank: true }, { required: true, class: "form-select" } %>
        </div>

        <div class="hidden">
          <% if waybill.new_record? %>
            <%= form.submit t("actions.save_record_next") %>
          <% else %>
            <%= hidden_field_tag "waybill[status]", "approved" %>
            <%= form.submit t("actions.approve"), data: { turbo_confirm: t("actions.confirm") } %>
          <% end %>
        </div>
      <% end %>
    </div>

    <% if allowed_to?(:scan?, waybill, with: ArrivalPolicy) %>
      <div class="bg-white p-4 rounded-lg">
        <ul role="list" class="space-y-3"
            id="waybill_storable_codes"
            data-controller="scan-preview"
            data-scan-preview-preview-url-value="<%= new_scan_url %>"
            data-scan-preview-whitelist-value="B,P"
            data-scan-preview-input-name-value="waybill[storable_codes][]">
          <li>
            <div class="relative block w-full rounded-lg border-2 border-dashed border-gray-300 p-12 text-center hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
              <%= inline_svg_tag "qrcode.svg", class: "mx-auto h-12 w-12 text-gray-400" %>
              <span class="mt-2 block text-sm font-semibold text-gray-900"><%= t("actions.scan_qr_code") %></span>
            </div>
          </li>
        </ul>
      </div>
    <% end %>
  </div>

  <% if allowed_to?(:scan?, waybill, with: ArrivalPolicy) %>
    <div class="mt-6 sticky bottom-0">
      <div class="bg-white p-4 rounded-lg">
        <div class="flex flex-col space-y-1">
          <% if allowed_to?(:destroy?, waybill, with: ArrivalPolicy) %>
            <%= button_to t("actions.destroy_record"), waybills_arrival_url(waybill), class: "mobile-btn-xl bg-red-500 text-white", method: :delete, data: { turbo_action: :replace, turbo_confirm: t("actions.confirm") } %>
          <% end %>
          <button type="button" class="mobile-btn-xl"
                  data-action="bridge--scanner#show"
                  data-bridge--scanner-place-param="waybill_storable_codes"
                  data-bridge--scanner-save-mode-param="prepend">
            <%= t("actions.scan") %>
          </button>
        </div>
      </div>
    </div>
  <% end %>
</div>